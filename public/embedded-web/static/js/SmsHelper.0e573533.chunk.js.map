{"version":3,"sources":["account/utils/brigeForNative.js","account/routeComponents/SmsHelper/index.module.scss","account/routeComponents/SmsHelper/index.jsx"],"names":["__webpack_require__","d","__webpack_exports__","addBrigeCallback","removeBrigeCallback","brigeCallbackMap","name","callback","callbackList","window","args","arguments","forEach","apply","push","index","findIndex","item","splice","length","module","exports","smsHelper","textWrapper","title","content","block","SmsBtn","CompleteBtn","isNetRequesting","speechSessionId","account","inMac","utils","getQueryParams","timer","Timer","BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME","config","RegistrationSmsHelpComp","props","_this","Object","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","this","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","goBack","history","go","state","vercodeBtnUseable","action","params","webkit","messageHandlers","postMessage","err","console","log","remainingTime","startTimer","count","stepCallback","time","jsCookie","get","setState","remainingTimeCallback","postMessageToMac","_this2","sig","sessionId","recipient","voiceotp","getSignByParam","axios","SEND_ONE_TIME_PASSWORD","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","then","data","success","set","expires","c","errors","code","confirm","OPERATION_TOO_FREQUENT","OPERATION_OVER_RUN","catch","error","finally","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","className","styles","CAN_NOT_RECEIVE_SMS_CODE","GO_TO_SMS_DESC","USE_VOICE_CODE_DESC","_components_BasicButton__WEBPACK_IMPORTED_MODULE_15__","text","GET_VOICE_CODE","buttonWrapperClass","onClick","getSpeechVerCode","bind","COMPELETE","Component"],"mappings":"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","file":"static/js/SmsHelper.0e573533.chunk.js","sourcesContent":["let brigeCallbackMap = {};\nexport const addBrigeCallback = (name,callback) => {\n    let callbackList;\n    if(!window[name]){\n        callbackList = brigeCallbackMap[name] = [];\n        window[name] = function() {\n            const args = arguments;\n            callbackList.forEach(callback => {\n                callback.apply(null,args);\n            });\n        }\n    }else{\n        callbackList = brigeCallbackMap[name];\n    }\n    callbackList.push(callback);\n};\n\nexport const removeBrigeCallback = (name, callback) =>{\n    let callbackList = brigeCallbackMap[name];\n    if(callbackList){\n        if(!callback){\n            callbackList.length = 0;\n        }else{\n            const index = callbackList.findIndex((item) => {\n                return item === callback;\n            });\n            callbackList.splice(index,1);\n        }\n    }\n};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"smsHelper\":\"SmsHelper_smsHelper__1yUE-\",\"textWrapper\":\"SmsHelper_textWrapper__1kLfb\",\"title\":\"SmsHelper_title__3Zgzg\",\"content\":\"SmsHelper_content__1Cl8v\",\"block\":\"SmsHelper_block__2Wh7N\",\"SmsBtn\":\"SmsHelper_SmsBtn__2klia\",\"CompleteBtn\":\"SmsHelper_CompleteBtn__3kM9q\"};","import React, { Component } from 'react';\nimport jsCookie from \"js-cookie\";\nimport config from '../../utils/config';\nimport utils from '../../utils/utils';\nimport axios from 'axios';\nimport Timer from '../../utils/Timer';\nimport {addBrigeCallback,removeBrigeCallback} from \"../../utils/brigeForNative\";\nimport {\n    CAN_NOT_RECEIVE_SMS_CODE,\n    GO_TO_SMS_DESC,\n    USE_VOICE_CODE_DESC,\n    GET_VOICE_CODE,\n    COMPELETE,\n    OPERATION_OVER_RUN,\n    OPERATION_TOO_FREQUENT,\n} from '../../config/copywriting';\nimport { SEND_ONE_TIME_PASSWORD } from '../../config/interfaceUrl';\nimport BasicButton from '../../components/BasicButton';\nimport confirm from '../../components/Confirm/Confirm';\n\nimport styles from './index.module.scss';\n\nlet isNetRequesting = false;//网络请求防抖\nlet speechSessionId = '';\nlet account = ''; // 账户信息\nconst from = utils.getQueryParams('from');\nconst inMac = from === 'mac';\n\nconst timer = new Timer();\nconst {BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME} = config;\nconst GET_VERCODE_ERROR_TOO_OFTEN=\"otp.too.often.error\";\nconst GET_VERCODE_ERROR_LIMIT_REACHED=\"otp.limit.reached.error\";\n\nexport default class RegistrationSmsHelpComp extends Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            inMac:false,\n            vercodeBtnUseable: true,\n        }\n    }\n\n    postMessageToMac(action,params){\n        try {\n            inMac && window.webkit.messageHandlers[action].postMessage(params);\n        } catch(err) {\n            console.log(err);\n        }\n    }\n    remainingTimeCallback(remainingTime){\n        console.log(remainingTime);\n        timer.startTimer({\n            count:remainingTime,\n            stepCallback(time){\n                console.log(time);\n            }\n        })\n    }\n\n    componentDidMount() {\n        account = jsCookie.get('registrationSpeechAccount');\n        // if (!account) this.props.history.go(-1);\n        this.setState({\n            inMac\n        });\n        addBrigeCallback(BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME,this.remainingTimeCallback);\n        this.postMessageToMac('remainingTime',{callback:BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME});\n    }\n\n    /**\n     * 关闭本页\n     */\n    closeCurPage() {\n        this.props.history.go(-1);\n    }\n\n\n    /**\n     * 获取语音验证码\n     */\n    getSpeechVerCode(){\n    \n        //验证码必须有合法手机号\n        if (!account) {\n            return;\n        }\n\n         //防抖\n         if (isNetRequesting) {\n            return;\n        }\n        isNetRequesting = true;\n\n        let recipient = account;\n        let sig;\n        let params;\n        if(speechSessionId){\n            params = {\n                sessionId: speechSessionId,\n                recipient,\n                voiceotp: ''\n            }\n        }else{\n            params = {\n                recipient,\n                voiceotp: ''\n            }\n        }\n        sig = utils.getSignByParam(params);\n\n        axios.get(SEND_ONE_TIME_PASSWORD, {\n            params: {sig,...params}\n        }).then((data) => {\n            if (data && data.data && data && data.data.success) {\n                if (data.data.sessionId) {\n                    speechSessionId = data.data.sessionId;\n                    jsCookie.set('speechSessionId',data.data.sessionId,{expires:1/24/6}); //把获取到的验证码存到 cookie 内,验证码十分钟过期\n                    this.postMessageToMac('sendCode',{sessionId:speechSessionId,c:data.data.c || ''});\n                    this.goBack();\n                }\n            }else{\n                if (data.data.errors && data.data.errors.length > 0) {\n                    let error = data.data.errors[0];\n                    switch (error.code) {\n                        case GET_VERCODE_ERROR_TOO_OFTEN:\n                            confirm({ content:OPERATION_TOO_FREQUENT });\n                            break;\n                        case GET_VERCODE_ERROR_LIMIT_REACHED:\n                            confirm({ content:OPERATION_OVER_RUN });\n                            break;\n                        default:\n                            break;\n                    }\n                }\n            }\n        }).catch(function (error) {\n            console.log(error);\n        }).finally(function () {\n            isNetRequesting = false; \n        });\n    }\n\n    componentWillUnmount(){\n        removeBrigeCallback(BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME,this.remainingTimeCallback);\n    }\n\n    goBack = () => {\n        this.props.history.go(-1);\n    }\n\n    render() {\n        return (\n            <div className={styles.smsHelper}>\n                <div className={styles.textWrapper}>\n                    <div className={styles.title}>\n                        {CAN_NOT_RECEIVE_SMS_CODE}\n                    </div>\n                    <ol className={styles.content}>\n                        <li className={styles.block}>\n                            <div>{GO_TO_SMS_DESC}</div>\n                        </li>\n                        <li>\n                            <div>{USE_VOICE_CODE_DESC}</div>\n                        </li>\n                    </ol>\n                </div>\n                <BasicButton\n                    text={GET_VOICE_CODE}\n                    buttonWrapperClass={styles.SmsBtn}\n                    onClick={this.getSpeechVerCode.bind(this)}\n                />\n                <BasicButton\n                    text={COMPELETE}\n                    buttonWrapperClass={styles.CompleteBtn}\n                    onClick={this.goBack}\n                />\n            </div>\n        )\n    }\n}\n"],"sourceRoot":""}