{"version":3,"sources":["account/components/LoginAccountInput/index.js","account/components/DisableAccountTip/index.js","account/components/DisableAccountTip/index.module.scss","account/routeComponents/BindExisted/index.module.scss","account/components/LoginPasswordInput/index.js","account/routeComponents/BindExisted/index.js"],"names":["DEFAULT","TIP_LEVEL_MAP","ERROR","ACCOUNT","INPUT_TYPE_MAP","LoginAccountInput","props","_this","Object","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","call","onBlur","state","account","tipLevel","verifyTip","onFocus","bind","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_4__","onChange","nextProps","inputType","resetInput","setState","ev","value","target","params","promise","_this2","_this$props","accountWasDisableTip","forgetCheck","identity","checkIdentity","get","REGISTRATION_CHECK","then","Promise","reject","catch","data","status","getValue","COMMON_ERROR_TIPS","ACCOUNT_NOT_EXISTED","Error","INFO_INCOMPELETE","finally","_this$state","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","className","styles","loginAccountInput","_BasicInput__WEBPACK_IMPORTED_MODULE_9__","placeHolder","INPUT_ACCOUNT","Component","defaultProps","react__WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","react__WEBPACK_IMPORTED_MODULE_0___default","n","_config_copywriting__WEBPACK_IMPORTED_MODULE_1__","_config_pageUrl__WEBPACK_IMPORTED_MODULE_2__","_utils_copywritingHelper__WEBPACK_IMPORTED_MODULE_3__","_index_module_scss__WEBPACK_IMPORTED_MODULE_4__","_index_module_scss__WEBPACK_IMPORTED_MODULE_4___default","DisableAccountTip","copywritingList","copywritingHelper","ACCOUNT_WAS_DISABLED","map","item","index","text","reactivateLink","href","REACTIVATION_URL","key","module","exports","bindExisted","accountInputWrapper","passwordInputWrapper","buttonWrapper","linkWrapper","bindCreateBtn","PASSWORD","LoginPasswordInput","classCallCheck","possibleConstructorReturn","getPrototypeOf","password","assertThisInitialized","resolve","_react_16_8_5_react_default","loginPasswordInput","BasicInput","INPUT_PASSWORD_REGISTER","INPUT_DEFAULT","BindExisted","forgotPassword","ClyClickForgetPassword","history","push","redirectToCreate","ClyClickCreateNewAccount","window","wx","closeWindow","bindAready","confirm","content","WX_BIND_ALREADY","operates","CREATE_NEW_ACCOUNT","main","onClick","SWITCH_ACCOUNT","accountTipLevel","accountVerifyTip","passwordTipLevel","passwordVerifyTip","requesting","goToBind","onPasswordInputChange","onAccountInputChange","_this$props$bindLogin","bindLoginInfo","ClyEnterBindExistedPage","_saveBindLoginInfo","saveBindLoginInfo","_ref","_ref2","verifyResponseContent","_this3","redirectTo","_setTwofactorInfo","setTwofactorInfo","wechatSessionId","ClyClickContinue","all","refs","accountInput","verifyInput","passwordInput","_ref3","_ref4","slicedToArray","jsCookie","set","expires","post","VERIFY_CREDENTIAL","needSignature","success","code","authToken","twoFactorEnabled","twoFactorHint","twoFactorToken","fromWechatLogin","updateVerifyInfo","PASSWORD_ERROR","BIND_USER_BY_AUTH_TOKEN","sessionId","INVALID_WECHAT_SESSION","ACCOUNT_ALREADY_BIND","WECHAT_ALREADY_BIND","err","console","log","_this$setState","_ref5","verifyTipKey","concat","tipLevelKey","defineProperty","_this$state2","ref","ClyEnterAccount","components_LoginPasswordInput","ClyEnterExistedPassword","INPUT_PASSWORD","BasicButton","LOGIN_ACCOUNT_TO_BIND","loading","FORGOT_PASSWORD","buttonWrapperClass","Separator","DIRECT_CREATE_NEW_ACCOUNT","mapDispatchToProps","info","connect"],"mappings":"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","file":"static/js/BindExisted.4ac02a31.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { get } from 'axios';\nimport { get as getValue } from 'lodash-es';\nimport BasicInput from '../BasicInput';\nimport { transformObjectToArray } from '../../utils/commonUtils';\nimport {\n  INPUT_TYPE_MAP,\n  TIP_LEVEL_MAP,\n} from '../../config/propsPermittedValueMap';\nimport {\n  COMMON_ERROR_TIPS,\n  INPUT_ACCOUNT,\n  INFO_INCOMPELETE,\n  ACCOUNT_NOT_EXISTED,\n} from '../../config/copywriting';\nimport { REGISTRATION_CHECK } from '../../config/interfaceUrl';\n\nimport styles from './index.module.scss';\n\nconst LEVEL_LIST = transformObjectToArray(TIP_LEVEL_MAP);\nconst INPUT_TYPE_LIST = transformObjectToArray(INPUT_TYPE_MAP);\nconst { DEFAULT, ERROR } = TIP_LEVEL_MAP;\nconst { ACCOUNT } = INPUT_TYPE_MAP;\n\nclass LoginAccountInput extends Component {\n  static propTypes = {\n    account: PropTypes.string,\n    resetInput: PropTypes.bool,\n    verifyTip: PropTypes.oneOfType([PropTypes.element, PropTypes.string]),\n    accountWasDisableTip: PropTypes.oneOfType([\n      PropTypes.element,\n      PropTypes.string,\n    ]),\n    tipLevel: PropTypes.oneOf(LEVEL_LIST),\n    inputType: PropTypes.oneOf(INPUT_TYPE_LIST),\n    onChange: PropTypes.func,\n    onBlur: PropTypes.func,\n    forgetCheck: PropTypes.bool, // 忘记密码模块使用时返回检查状态\n  };\n\n  static defaultProps = {\n    account: '',\n    resetInput: false,\n    accountWasDisableTip: '',\n    onChange: () => {},\n    onBlur: () => {},\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      account: '',\n      tipLevel: DEFAULT,\n      verifyTip: '',\n    };\n    this.onFocus = this.onFocus.bind(this);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { verifyTip, tipLevel, inputType, account, resetInput } = nextProps;\n    if (inputType === ACCOUNT) {\n      this.setState({\n        verifyTip,\n        tipLevel,\n      });\n    }\n    if (resetInput) {\n      this.setState({\n        account,\n      });\n    }\n  }\n\n  onFocus() {\n    this.setState({\n      tipLevel: DEFAULT,\n      verifyTip: '',\n    });\n  }\n\n  onChange(ev) {\n    const {\n      target: { value },\n    } = ev;\n    const { onChange } = this.props;\n    this.setState({\n      account: value,\n    });\n    onChange(ev);\n  }\n\n  onBlur = () => {\n    this.props.onBlur();\n  }\n\n  verifyInput() {\n    const { account } = this.state;\n    const {\n      accountWasDisableTip,\n      forgetCheck,\n    } = this.props;\n    let verifyTip = '';\n    let tipLevel = '';\n    let params;\n    let promise;\n    if (!account) {\n      tipLevel = ERROR;\n      verifyTip = INFO_INCOMPELETE;\n      promise = Promise.reject(new Error(verifyTip));\n    } else {\n      params = {\n        identity: account,\n        checkIdentity: '',\n      };\n      promise = get(REGISTRATION_CHECK, {\n        params,\n      })\n        .then(() => {\n          // 此情况说明帐户不存在\n          return Promise.reject();\n        })\n        .catch(data => {\n          const status = getValue(data, 'response.status');\n          if (!data) {\n            tipLevel = ERROR;\n            verifyTip = ACCOUNT_NOT_EXISTED;\n          } else {\n            switch (status) {\n              case 409:\n                tipLevel = DEFAULT;\n                verifyTip = '';\n                break;\n              case 412:\n                tipLevel = ERROR;\n                verifyTip = accountWasDisableTip;\n                break;\n              default:\n                tipLevel = ERROR;\n                verifyTip = COMMON_ERROR_TIPS;\n                break;\n            }\n          }\n          if (tipLevel === DEFAULT) {\n            if (forgetCheck) return getValue(data, 'response.data');;\n            return account;\n          }\n          return Promise.reject(new Error(verifyTip));\n        });\n    }\n    return promise.finally(() => {\n      this.setState({\n        verifyTip,\n        tipLevel,\n      });\n    });\n  }\n\n  render() {\n    const { tipLevel, verifyTip, account } = this.state;\n    return (\n      <div className={styles.loginAccountInput}>\n        <BasicInput\n          placeHolder={INPUT_ACCOUNT}\n          tipLevel={tipLevel}\n          value={account}\n          onFocus={this.onFocus}\n          onChange={this.onChange}\n          onBlur={this.onBlur}\n        >\n          {verifyTip}\n        </BasicInput>\n      </div>\n    );\n  }\n}\n\nexport default LoginAccountInput;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { ACCOUNT_WAS_DISABLED } from '../../config/copywriting';\nimport { REACTIVATION_URL } from '../../config/pageUrl';\nimport copywritingHelper from '../../utils/copywritingHelper';\n\nimport styles from './index.module.scss';\n\nconst DisableAccountTip = props => {\n  const copywritingList = copywritingHelper(ACCOUNT_WAS_DISABLED);\n  const { account } = props;\n  return (\n    <span>\n      {copywritingList.map((item, index) => {\n        let text = '';\n        switch (index) {\n          case 1:\n            text = account;\n            break;\n          case 3:\n            text = (\n              <a\n                className={styles.reactivateLink}\n                href={REACTIVATION_URL}\n                key={index}\n              >\n                {item}\n              </a>\n            );\n            break;\n          default:\n            text = item;\n        }\n        return text;\n      })}\n    </span>\n  );\n};\n\nDisableAccountTip.propTypes = {\n  account: PropTypes.string.isRequired,\n};\n\nexport default DisableAccountTip;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"reactivateLink\":\"DisableAccountTip_reactivateLink__2mLSq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"bindExisted\":\"BindExisted_bindExisted__2-Mv_\",\"accountInputWrapper\":\"BindExisted_accountInputWrapper__3KaMR\",\"passwordInputWrapper\":\"BindExisted_passwordInputWrapper__bH5rA\",\"buttonWrapper\":\"BindExisted_buttonWrapper__1hsj9\",\"linkWrapper\":\"BindExisted_linkWrapper__1t1o8\",\"bindCreateBtn\":\"BindExisted_bindCreateBtn__gLMKg\"};","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport BasicInput from '../BasicInput';\nimport { transformObjectToArray } from '../../utils/commonUtils';\nimport {\n  INPUT_TYPE_MAP,\n  TIP_LEVEL_MAP,\n} from '../../config/propsPermittedValueMap';\nimport { INFO_INCOMPELETE, INPUT_PASSWORD_REGISTER } from '../../config/copywriting';\n\nimport styles from './index.module.scss';\n\nconst LEVEL_LIST = transformObjectToArray(TIP_LEVEL_MAP);\nconst INPUT_TYPE_LIST = transformObjectToArray(INPUT_TYPE_MAP);\nconst { DEFAULT, ERROR } = TIP_LEVEL_MAP;\nconst { PASSWORD } = INPUT_TYPE_MAP;\n\nclass LoginPasswordInput extends Component {\n  static propTypes = {\n    password: PropTypes.string,\n    resetInput: PropTypes.bool,\n    verifyTip: PropTypes.oneOfType([PropTypes.element, PropTypes.string]),\n    tipLevel: PropTypes.oneOf(LEVEL_LIST),\n    inputType: PropTypes.oneOf(INPUT_TYPE_LIST),\n    onChange: PropTypes.func,\n    onBlur: PropTypes.func,\n    placeHolder: PropTypes.string,\n  };\n\n  static defaultProps = {\n    password: '',\n    resetInput: false,\n    onChange: () => {},\n    onBlur: () => {},\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      password: '',\n      tipLevel: DEFAULT,\n      verifyTip: '',\n    };\n    this.onFocus = this.onFocus.bind(this);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { verifyTip, tipLevel, inputType, password, resetInput } = nextProps;\n    if (inputType === PASSWORD) {\n      this.setState({\n        verifyTip,\n        tipLevel,\n      });\n    }\n    if (resetInput) {\n      this.setState({\n        password,\n      });\n    }\n  }\n\n  onFocus() {\n    this.setState({\n      tipLevel: DEFAULT,\n      verifyTip: '',\n    });\n  }\n\n  onChange(ev) {\n    const {\n      target: { value },\n    } = ev;\n    const { onChange } = this.props;\n    this.setState({\n      password: value,\n    });\n    onChange(ev);\n  }\n\n  verifyInput() {\n    const { password } = this.state;\n    if (!password) {\n      this.setState({\n        verifyTip: INFO_INCOMPELETE,\n        tipLevel: ERROR,\n      });\n      return Promise.reject(new Error(INFO_INCOMPELETE));\n    }\n    return Promise.resolve(password);\n  }\n\n  render() {\n    const { tipLevel, verifyTip, password } = this.state;\n    const { placeHolder } = this.props;\n    return (\n      <div className={styles.loginPasswordInput}>\n        <BasicInput\n          placeHolder={placeHolder || INPUT_PASSWORD_REGISTER}\n          tipLevel={tipLevel}\n          value={password}\n          inputType=\"password\"\n          onFocus={this.onFocus}\n          onChange={this.onChange}\n          onBlur={this.props.onBlur}\n        >\n          {verifyTip}\n        </BasicInput>\n      </div>\n    );\n  }\n}\n\nexport default LoginPasswordInput;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { post } from 'axios';\nimport { get as getValue } from 'lodash-es';\nimport jsCookie from 'js-cookie';\nimport LoginAccountInput from '../../components/LoginAccountInput';\nimport LoginPasswordInput from '../../components/LoginPasswordInput';\nimport BasicButton from '../../components/BasicButton';\n// import ForgotPasswordLink from '../../components/ForgotPasswordLink';\nimport Separator from '../../components/Separator';\nimport DisableAccountTip from '../../components/DisableAccountTip';\nimport confirm from '../../components/Confirm/Confirm';\n\nimport {\n  LOGIN_ACCOUNT_TO_BIND,\n  ACCOUNT_ALREADY_BIND,\n  WECHAT_ALREADY_BIND,\n  PASSWORD_ERROR,\n  COMMON_ERROR_TIPS,\n  INVALID_WECHAT_SESSION,\n  INPUT_PASSWORD,\n  FORGOT_PASSWORD,\n  DIRECT_CREATE_NEW_ACCOUNT,\n  WX_BIND_ALREADY,\n  CREATE_NEW_ACCOUNT,\n  SWITCH_ACCOUNT,\n} from '../../config/copywriting';\nimport {\n  TIP_LEVEL_MAP,\n  INPUT_TYPE_MAP,\n} from '../../config/propsPermittedValueMap';\nimport {\n  BIND_USER_BY_AUTH_TOKEN,\n  VERIFY_CREDENTIAL,\n} from '../../config/interfaceUrl';\nimport { LOGIN_URL } from '../../config/pageUrl';\nimport { loginAfterBind } from '../../utils/commonUtils';\nimport { setTwofactorInfo, saveBindLoginInfo } from '../../store/actions';\nimport { \n  ClyEnterBindExistedPage,\n  ClyEnterAccount,\n  ClyEnterExistedPassword,\n  ClyClickContinue,\n  ClyClickForgetPassword,\n  ClyClickCreateNewAccount,\n} from '../../countly/countlyPoints';\n\nimport styles from './index.module.scss';\n\nconst { DEFAULT, ERROR } = TIP_LEVEL_MAP;\nconst { ACCOUNT, PASSWORD, DEFAULT: INPUT_DEFAULT } = INPUT_TYPE_MAP;\n\nclass BindExisted extends Component {\n  static propTypes = {\n    wechatSessionId: PropTypes.string.isRequired,\n    setTwofactorInfo: PropTypes.func.isRequired,\n    bindLoginInfo: PropTypes.object.isRequired,\n    saveBindLoginInfo: PropTypes.func.isRequired,\n    history: PropTypes.object.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      account: '',\n      accountTipLevel: DEFAULT,\n      accountVerifyTip: '',\n      password: '',\n      passwordTipLevel: DEFAULT,\n      passwordVerifyTip: '',\n      inputType: INPUT_DEFAULT,\n      requesting: false,\n      resetInput: false,\n    };\n    this.goToBind = this.goToBind.bind(this);\n    this.onPasswordInputChange = this.onPasswordInputChange.bind(this);\n    this.onAccountInputChange = this.onAccountInputChange.bind(this);\n  }\n\n  componentDidMount() {\n    const {\n      bindLoginInfo: { account, password },\n    } = this.props;\n    this.setState(\n      {\n        account,\n        password,\n        resetInput: true,\n      },\n      () => {\n        this.setState({\n          resetInput: false,\n        });\n      },\n    );\n    ClyEnterBindExistedPage();\n  }\n\n  componentWillUnmount() {\n    const { account, password } = this.state;\n    const { saveBindLoginInfo: _saveBindLoginInfo } = this.props;\n    _saveBindLoginInfo({\n      account,\n      password,\n    });\n  }\n\n  onAccountInputChange({ target: { value } }) {\n    this.setState({\n      account: value,\n    });\n  }\n\n  onPasswordInputChange({ target: { value } }) {\n    this.setState({\n      password: value,\n    });\n  }\n\n  forgotPassword = () => {\n    ClyClickForgetPassword();\n    this.props.history.push('/forget-password')\n  }\n\n\n  redirectToCreate = () => {\n    ClyClickCreateNewAccount()\n    window.wx.closeWindow();\n    this.props.history.push('/bind-create');\n  }\n\n  goToBind() {\n    let redirectTo = '';\n    let verifyResponseContent;\n    const {\n      history,\n      setTwofactorInfo: _setTwofactorInfo,\n      wechatSessionId,\n    } = this.props;\n    ClyClickContinue();\n    this.setState({\n      requesting: true,\n    });\n    Promise.all([\n      this.refs.accountInput.verifyInput(),\n      this.refs.passwordInput.verifyInput(),\n    ])\n      .then(([account, password]) => {\n        jsCookie.set('registrationSpeechAccount', account, {\n          expires: 1 / 24 / 60,\n        });\n        return post(\n          VERIFY_CREDENTIAL,\n          {\n            identity: account,\n            password,\n          },\n          {\n            needSignature: true,\n          },\n        );\n      })\n      .then(data => {\n        const code = getValue(data, 'data.code');\n        const authToken = getValue(data, 'data.content.authToken');\n        const twoFactorEnabled = getValue(\n          data,\n          'data.content.twoFactorEnabled',\n        );\n        const twoFactorHint = getValue(data, 'data.content.twoFactorHint');\n        let success;\n        verifyResponseContent = getValue(data, 'data.content');\n        switch (code) {\n          case 200:\n            if (twoFactorEnabled) {\n              _setTwofactorInfo({\n                twoFactorEnabled,\n                twoFactorHint,\n                twoFactorToken: authToken,\n                fromWechatLogin: false,\n              });\n              success = false;\n              redirectTo = '/twofactor-verification';\n            } else {\n              success = !!authToken; // 确保接口的确返回了 authToken, 有 authToken 才算成功\n            }\n            break;\n          case 403:\n            this.updateVerifyInfo(PASSWORD, {\n              tipLevel: ERROR,\n              verifyTip: PASSWORD_ERROR,\n            });\n            success = false;\n            break;\n          default:\n            success = false;\n            this.updateVerifyInfo(PASSWORD, {\n              tipLevel: ERROR,\n              verifyTip: PASSWORD_ERROR,\n            });\n        }\n        if (success) {\n          return authToken;\n        }\n        return Promise.reject();\n      })\n      .then(authToken => {\n        return post(\n          BIND_USER_BY_AUTH_TOKEN,\n          {\n            authToken,\n            sessionId: wechatSessionId,\n          },\n          {\n            needSignature: true,\n          },\n        );\n      })\n      .then(data => {\n        const code = getValue(data, 'data.code');\n        let success;\n        switch (code) {\n          case 200:\n            success = true;\n            break;\n          case 404:\n            success = true;\n            confirm({ content:INVALID_WECHAT_SESSION });\n            break;\n          case 423:\n            success = false;\n            this.updateVerifyInfo(ACCOUNT, {\n              tipLevel: ERROR,\n              verifyTip: ACCOUNT_ALREADY_BIND,\n            });\n            break;\n          case 425:\n            success = false;\n            this.bindAready();\n            confirm({ content: WECHAT_ALREADY_BIND });\n            break;\n          default:\n            success = false;\n            confirm({ content: COMMON_ERROR_TIPS });\n        }\n        if (success) {\n          return verifyResponseContent;\n        }\n        return Promise.reject();\n      })\n      .then(() => {\n        window.wx.closeWindow && window.wx.closeWindow();\n      })\n      .catch(err => {\n        console.log(err);\n      })\n      .finally(() => {\n        if (!redirectTo) {\n          // 防止在跳转后组件已经卸载但是仍然更新 state 导致内存泄露\n          this.setState({\n            inputType: INPUT_DEFAULT,\n            requesting: false,\n          });\n        } else {\n          history.push(redirectTo);\n        }\n      });\n  }\n\n  bindAready = () => {\n    confirm({\n      content: WX_BIND_ALREADY,\n      operates: [{\n        text: CREATE_NEW_ACCOUNT,\n        main: true,\n        onClick: () => this.props.history.push('/bind-create'),\n      },\n      {\n        text: SWITCH_ACCOUNT,\n        main: true,\n        onClick: () => {\n          this.setState({\n            account: '',\n            password: '',\n            resetInput: true,\n          }, \n          () => {\n            this.setState({\n              resetInput: false,\n            })\n          })\n        },\n      }]\n    })\n  }\n\n  updateVerifyInfo(inputType, { tipLevel, verifyTip }) {\n    const verifyTipKey = `${inputType}VerifyTip`;\n    const tipLevelKey = `${inputType}TipLevel`;\n    this.setState({\n      inputType,\n      [verifyTipKey]: verifyTip,\n      [tipLevelKey]: tipLevel,\n    });\n  }\n\n  render() {\n    const {\n      account,\n      password,\n      accountTipLevel,\n      accountVerifyTip,\n      passwordTipLevel,\n      passwordVerifyTip,\n      requesting,\n      inputType,\n      resetInput,\n    } = this.state;\n    const accountWasDisableTip = <DisableAccountTip account={account} />;\n    return (\n      <div className={styles.bindExisted}>\n        <div className={styles.accountInputWrapper}>\n          <LoginAccountInput\n            ref=\"accountInput\"\n            tipLevel={accountTipLevel}\n            verifyTip={accountVerifyTip}\n            inputType={inputType}\n            account={account}\n            accountWasDisableTip={accountWasDisableTip}\n            onChange={this.onAccountInputChange}\n            onBlur={ClyEnterAccount}\n            resetInput={resetInput}\n          />\n        </div>\n        <div className={styles.passwordInputWrapper}>\n          <LoginPasswordInput\n            ref=\"passwordInput\"\n            tipLevel={passwordTipLevel}\n            verifyTip={passwordVerifyTip}\n            inputType={inputType}\n            password={password}\n            onChange={this.onPasswordInputChange}\n            onBlur={ClyEnterExistedPassword}\n            resetInput={resetInput}\n            placeHolder={INPUT_PASSWORD}\n          />\n        </div>\n        <div className={styles.buttonWrapper}>\n          <BasicButton\n            text={LOGIN_ACCOUNT_TO_BIND}\n            onClick={this.goToBind}\n            loading={requesting}\n          />\n        </div>\n        <div className={styles.linkWrapper}>\n          <BasicButton text={FORGOT_PASSWORD}\n                       buttonWrapperClass={styles.linkWrapper}\n                       onClick={this.forgotPassword}\n          />\n        </div>\n        <Separator />\n        <BasicButton\n          text={DIRECT_CREATE_NEW_ACCOUNT}\n          buttonWrapperClass={styles.bindCreateBtn}\n          onClick={this.redirectToCreate}\n          loading={requesting}\n        />\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    wechatSessionId: state.wechatSessionId,\n    bindLoginInfo: state.bindLoginInfo,\n  };\n};\nconst mapDispatchToProps = {\n  setTwofactorInfo: info => {\n    return setTwofactorInfo(info);\n  },\n  saveBindLoginInfo: info => {\n    return saveBindLoginInfo(info);\n  },\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(BindExisted);\n"],"sourceRoot":""}