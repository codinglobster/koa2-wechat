{"version":3,"sources":["account/utils/brigeForNative.js","account/routeComponents/TwoFactorHelper/index.module.scss","account/routeComponents/TwoFactorHelper/index.jsx"],"names":["__webpack_require__","d","__webpack_exports__","addBrigeCallback","removeBrigeCallback","brigeCallbackMap","name","callback","callbackList","window","args","arguments","forEach","apply","push","index","findIndex","item","splice","length","module","exports","twoFactorHelper","textWrapper","title","content","block","order","titleSeparator","messageSeparator","backupSeparator","messageBtn","useBackupBtn","completeBtn","isNetRequesting","speechSessionId","account","inMac","utils","getQueryParams","timer","Timer","BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME","config","RegistrationSmsHelpComp","props","_this","Object","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__","this","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__","call","goBack","history","go","state","vercodeBtnUseable","action","params","webkit","messageHandlers","postMessage","err","console","log","remainingTime","startTimer","count","stepCallback","time","jsCookie","get","setState","remainingTimeCallback","postMessageToMac","registrationType","opener","open","close","type","undefined","sig","recipient","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_1__","assign","getSignByParam","SEND_ONE_TIME_PASSWORD","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","then","data","sessionId","getValue","errorCode","set","expires","confirm","OPERATION_TOO_FREQUENT","OPERATION_OVER_RUN","catch","error","finally","twoFactorHint","twoFactorInfo","strArr","copywritingHelper","RECEIVE_CODE_FROM","react__WEBPACK_IMPORTED_MODULE_7___default","a","createElement","className","styles","TWO_FACTOR_HELPER","_components_Separator__WEBPACK_IMPORTED_MODULE_19__","pure","join","_components_BasicButton__WEBPACK_IMPORTED_MODULE_20__","text","SEND_TEXT_MESSGE","buttonWrapperClass","onClick","getVerCodeByType","bind","GET_VOICE_CODE","USE_BACKUP_CODE_DESC","USE_BACKUP_CODE","COMPELETE","Component","connect","wechatSessionId"],"mappings":"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","file":"static/js/TwoFactorHelper.cbaf98c0.chunk.js","sourcesContent":["let brigeCallbackMap = {};\nexport const addBrigeCallback = (name,callback) => {\n    let callbackList;\n    if(!window[name]){\n        callbackList = brigeCallbackMap[name] = [];\n        window[name] = function() {\n            const args = arguments;\n            callbackList.forEach(callback => {\n                callback.apply(null,args);\n            });\n        }\n    }else{\n        callbackList = brigeCallbackMap[name];\n    }\n    callbackList.push(callback);\n};\n\nexport const removeBrigeCallback = (name, callback) =>{\n    let callbackList = brigeCallbackMap[name];\n    if(callbackList){\n        if(!callback){\n            callbackList.length = 0;\n        }else{\n            const index = callbackList.findIndex((item) => {\n                return item === callback;\n            });\n            callbackList.splice(index,1);\n        }\n    }\n};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"twoFactorHelper\":\"TwoFactorHelper_twoFactorHelper__2LoU_\",\"textWrapper\":\"TwoFactorHelper_textWrapper__2d03K\",\"title\":\"TwoFactorHelper_title__1-dvS\",\"content\":\"TwoFactorHelper_content__i2DLx\",\"block\":\"TwoFactorHelper_block__Kkvnh\",\"item\":\"TwoFactorHelper_item__QLES5\",\"order\":\"TwoFactorHelper_order__3pjHo\",\"titleSeparator\":\"TwoFactorHelper_titleSeparator__1jw6q\",\"messageSeparator\":\"TwoFactorHelper_messageSeparator__1lpAK\",\"backupSeparator\":\"TwoFactorHelper_backupSeparator__1O-Mg\",\"messageBtn\":\"TwoFactorHelper_messageBtn__2MDks\",\"useBackupBtn\":\"TwoFactorHelper_useBackupBtn__26yHA\",\"completeBtn\":\"TwoFactorHelper_completeBtn__1_qUn\"};","import React, { Component } from 'react';\nimport jsCookie from \"js-cookie\";\nimport config from '../../utils/config';\nimport { connect } from 'react-redux';\nimport utils from '../../utils/utils';\nimport { get } from 'axios';\nimport { get as getValue } from 'lodash-es';\nimport Timer from '../../utils/Timer';\nimport { addBrigeCallback,removeBrigeCallback } from \"../../utils/brigeForNative\";\nimport {\n    TWO_FACTOR_HELPER,\n    RECEIVE_CODE_FROM,\n    SEND_TEXT_MESSGE,\n    USE_BACKUP_CODE_DESC,\n    USE_BACKUP_CODE,\n    COMPELETE,\n    GET_VOICE_CODE,\n    OPERATION_TOO_FREQUENT,\n    OPERATION_OVER_RUN,\n} from '../../config/copywriting';\nimport { SEND_ONE_TIME_PASSWORD } from '../../config/interfaceUrl';\nimport copywritingHelper from '../../utils/copywritingHelper';\n\nimport Separator from '../../components/Separator';\nimport BasicButton from '../../components/BasicButton';\nimport confirm from '../../components/Confirm/Confirm';\n\nimport styles from './index.module.scss';\n\nlet isNetRequesting = false;//网络请求防抖\nlet speechSessionId = '';\nlet account = ''; // 账户信息\nconst from = utils.getQueryParams('from');\nconst inMac = from === 'mac';\n\nconst timer = new Timer();\nconst {BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME} = config;\nconst GET_VERCODE_ERROR_TOO_OFTEN=\"otp.too.often.error\";\nconst GET_VERCODE_ERROR_LIMIT_REACHED=\"otp.limit.reached.error\";\n\nclass RegistrationSmsHelpComp extends Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            inMac:false,\n            vercodeBtnUseable: true,\n        }\n    }\n\n    postMessageToMac(action,params){\n        try {\n            inMac && window.webkit.messageHandlers[action].postMessage(params);\n        } catch(err) {\n            console.log(err);\n        }\n    }\n    remainingTimeCallback(remainingTime){\n        console.log(remainingTime);\n        timer.startTimer({\n            count:remainingTime,\n            stepCallback(time){\n                console.log(time);\n            }\n        })\n    }\n\n    componentDidMount() {\n        account = jsCookie.get('registrationSpeechAccount');\n        this.setState({\n            inMac\n        });\n        // utils.setWindowTitle(UNABLE_TO_GET_VERIFICATION);\n        addBrigeCallback(BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME,this.remainingTimeCallback);\n        this.postMessageToMac('remainingTime',{callback:BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME});\n    }\n\n    /**\n     * 关闭本页\n     */\n    closeCurPage(registrationType) {\n        window.opener = null;\n        window.open('', '_self');\n        window.close();\n        this.postMessageToMac('closeWindow','');\n    }\n\n\n    /**\n     * 获取语音/短信验证码\n     */\n    getVerCodeByType(type = 'voiceotp'){\n        const _this = this;\n        //验证码必须有合法手机号\n        if (!account) {\n            return;\n        }\n\n         //防抖\n        if (isNetRequesting) {\n            return;\n        }\n        isNetRequesting = true;\n\n        let recipient = account;\n        let sig;\n        let params = {\n            recipient,\n            [type]: '',\n        };\n        if(speechSessionId){\n            params = Object.assign({}, params, {\n                speechSessionId,\n            })\n        }\n        sig = utils.getSignByParam(params);\n\n        get(SEND_ONE_TIME_PASSWORD, {\n            params: {sig,...params}\n        }).then((data) => {\n            const sessionId = getValue(data, 'data.sessionId');\n            const errorCode = getValue(data, 'data.errors[0].code');\n            if (sessionId) {\n                speechSessionId = sessionId;\n                jsCookie.set('speechSessionId', sessionId ,{expires:1/24/6}); //把获取到的验证码存到 cookie 内,验证码十分钟过期\n            }else{\n                if (errorCode) {\n                    switch (errorCode) {\n                        case GET_VERCODE_ERROR_TOO_OFTEN:\n                            confirm({ content: OPERATION_TOO_FREQUENT });\n                            break;\n                        case GET_VERCODE_ERROR_LIMIT_REACHED:\n                            confirm({ content: OPERATION_OVER_RUN });\n                            break;\n                        default:\n                            break;\n                    }\n                }\n            }\n        }).catch(function (error) {\n            console.log(error);\n        }).finally(function () {\n            isNetRequesting = false;\n            _this.goBack();\n        });\n    }\n\n    componentWillUnmount(){\n        removeBrigeCallback(BRIGE_CALLBACK_NAME_FOR_GET_REMAINING_TIME,this.remainingTimeCallback);\n    }\n\n    goBack = () => {\n        this.props.history.go(-1);\n    }\n\n    render() {\n        const {\n            twoFactorInfo: { twoFactorHint },\n        } = this.props;\n        const strArr = copywritingHelper(RECEIVE_CODE_FROM);\n        strArr[1] = twoFactorHint; // replace phone number\n\n        return (\n            <div className={styles.twoFactorHelper}>\n                <div className={styles.textWrapper}>\n                    <div className={styles.title}>\n                        {TWO_FACTOR_HELPER}\n                    </div>\n                    <Separator pure className={styles.titleSeparator}/>\n                    <div className={styles.content}>\n                        <div className={styles.block}>\n                            <div className={styles.item}>\n                                <div className={styles.order}>1. </div>\n                                <div>{strArr.join('')}</div>\n                            </div>\n                            <BasicButton\n                                text={SEND_TEXT_MESSGE}\n                                buttonWrapperClass={styles.messageBtn}\n                                onClick={this.getVerCodeByType.bind(this, 'textotp')}\n                            />\n                            <BasicButton\n                                text={GET_VOICE_CODE}\n                                buttonWrapperClass={styles.messageBtn}\n                                onClick={this.getVerCodeByType.bind(this, 'voiceotp')}\n                            />\n                        </div>\n                        <Separator pure className={styles.messageSeparator} />\n                        <div className={styles.block}>\n                            <div className={styles.item}>\n                                <div className={styles.order}>2. </div>\n                                <div>{USE_BACKUP_CODE_DESC}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <BasicButton\n                    text={USE_BACKUP_CODE}\n                    buttonWrapperClass={styles.useBackupBtn}\n                    onClick={this.goBack}\n                />\n                <Separator pure className={styles.backupSeparator}/>\n                <BasicButton\n                    text={COMPELETE}\n                    buttonWrapperClass={styles.completeBtn}\n                    onClick={this.goBack}\n                />\n            </div>\n        )\n    }\n}\n\nconst mapStateToProps = state => {\n    const { wechatSessionId, twoFactorInfo } = state;\n    return {\n      wechatSessionId,\n      twoFactorInfo,\n    };\n};\n  \nexport default connect(\n    mapStateToProps,\n)(RegistrationSmsHelpComp);\n"],"sourceRoot":""}