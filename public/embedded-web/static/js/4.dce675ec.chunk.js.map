{"version":3,"sources":["account/config/interfaceErrorCodeMap.js","account/components/VercodeInput/index.js","account/components/VercodeInput/index.module.scss"],"names":["__webpack_require__","d","__webpack_exports__","GET_VERCODE_ERROR_TOO_OFTEN","GET_VERCODE_ERROR_LIMIT_REACHED","ERROR_CODE_VALUE_DAES_NOT_MATCH","ERROR_CODE_PASSWORD_TOO_WEAK","ERROR_CODE_VALUE_NOT_PRESENT","OTP_INTERGRITY_CHECK","VIRTUAL_PHONENUMBER_CODE","REGISTRATION_EMAIL_INVALID","timer","Timer","DEFAULT","TIP_LEVEL_MAP","ERROR","VERCODE","INPUT_TYPE_MAP","VercodeInput","props","_this","Object","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","this","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__","call","state","vercode","tipLevel","verifyTip","countTime","requesting","onFocus","bind","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__","onChange","getVercode","nextProps","oldVercodeTimeRemain","vercodeTimeRemain","inputType","setState","startTimer","count","stepCallback","updateCountTime","timeOverCallback","updateParentCountState","stopTimer","value","_ref","target","_this2","_this$props","verify","updateSmsSessionId","getVercodeHooks","then","_ref2","params","recipient","account","textotp","sig","getSignatureByParam","get","SEND_ONE_TIME_PASSWORD","_Users_LiuXiao_workfiled_embedded_web_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","data","sessionId","getValue","errorCode","c","alert","OPERATION_TOO_FREQUENT","OPERATION_OVER_RUN","COMMON_ERROR_TIPS","catch","err","console","log","finally","countStatus","updateCountState","onVercodeTimeChange","promise","_this3","VERCODE_REG","test","Promise","resolve","INVALID_VERIFICATION_CODE","reject","Error","EMPTY_VERIFICATION_CODE","_this$state","_this$props2","customTip","onBlur","countEnd","react__WEBPACK_IMPORTED_MODULE_7___default","a","createElement","className","styles","vercodeInput","inputWrapper","_BasicInput__WEBPACK_IMPORTED_MODULE_10__","placeHolder","INPUT_VERCODE","useDefaultTip","textWrapper","concat","text","normalText","hide","onClick","GET_VERCODE","countingText","REGET_AFTER_SOME_SECONDS","loadingIconWrapper","_LoadingIcon__WEBPACK_IMPORTED_MODULE_11__","Component","defaultProps","module","exports"],"mappings":"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","file":"static/js/4.dce675ec.chunk.js","sourcesContent":["const GET_VERCODE_ERROR_TOO_OFTEN = 'otp.too.often.error';\nconst GET_VERCODE_ERROR_LIMIT_REACHED = 'otp.limit.reached.error';\nconst ERROR_CODE_VALUE_DAES_NOT_MATCH = 'validation.mask.valueDoesNotMatch';\nconst ERROR_CODE_PASSWORD_TOO_WEAK = 'password.too.weak';\nconst RESET_PASSWORD_PRE_SIGNATURE_ERROR = 'reset.password.pre.signature.error';\nconst ERROR_CODE_VALUE_NOT_PRESENT = 'validation.required.valueNotPresent';\nconst ONE_TIME_PASSWORD_INVALID = 'one.time.password.invalid';\nconst OTP_INTERGRITY_CHECK = 'otp.intergrity.check';\nconst ERROR_CODE_OTP_INVALID = 'phone.number.bind.invalid.otp';\nconst VALIDATION_REQUIRED_VALUE_NOT_PRESENT =\n  'validation.required.valueNotPresent';\nconst BIND_PHONE_ERROR_SIGNATURE = 'bind.phone.number.error.signature';\nconst VIRTUAL_PHONENUMBER_CODE = 'registration.invalid.virtual.phone.number';\nconst REGISTRATION_EMAIL_INVALID = 'registrationAction.email.invalid';\n\nexport {\n  GET_VERCODE_ERROR_TOO_OFTEN,\n  GET_VERCODE_ERROR_LIMIT_REACHED,\n  ERROR_CODE_VALUE_DAES_NOT_MATCH,\n  ERROR_CODE_PASSWORD_TOO_WEAK,\n  RESET_PASSWORD_PRE_SIGNATURE_ERROR,\n  ERROR_CODE_VALUE_NOT_PRESENT,\n  ONE_TIME_PASSWORD_INVALID,\n  OTP_INTERGRITY_CHECK,\n  ERROR_CODE_OTP_INVALID,\n  VALIDATION_REQUIRED_VALUE_NOT_PRESENT,\n  BIND_PHONE_ERROR_SIGNATURE,\n  VIRTUAL_PHONENUMBER_CODE,\n  REGISTRATION_EMAIL_INVALID,\n};\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { get } from 'axios';\nimport { get as getValue } from 'lodash-es';\nimport BasicInput from '../BasicInput';\nimport LoadingIcon from '../LoadingIcon';\nimport {\n  INPUT_VERCODE,\n  EMPTY_VERIFICATION_CODE,\n  GET_VERCODE,\n  REGET_AFTER_SOME_SECONDS,\n  OPERATION_TOO_FREQUENT,\n  OPERATION_OVER_RUN,\n  COMMON_ERROR_TIPS,\n  INVALID_VERIFICATION_CODE,\n} from '../../config/copywriting';\nimport {\n  TIP_LEVEL_MAP,\n  INPUT_TYPE_MAP,\n} from '../../config/propsPermittedValueMap';\nimport { SEND_ONE_TIME_PASSWORD } from '../../config/interfaceUrl';\nimport {\n  GET_VERCODE_ERROR_TOO_OFTEN,\n  GET_VERCODE_ERROR_LIMIT_REACHED,\n} from '../../config/interfaceErrorCodeMap';\nimport { VERCODE_REG } from '../../config/commonRegex';\nimport Timer from '../../utils/Timer';\nimport { transformObjectToArray } from '../../utils/commonUtils';\nimport { getSignatureByParam } from '../../utils/signatureUtils';\n\nimport styles from './index.module.scss';\n\nconst timer = new Timer();\nconst { DEFAULT, ERROR } = TIP_LEVEL_MAP;\nconst LEVEL_LIST = transformObjectToArray(TIP_LEVEL_MAP);\nconst INPUT_TYPE_LIST = transformObjectToArray(INPUT_TYPE_MAP);\nconst { VERCODE } = INPUT_TYPE_MAP;\n\nclass VercodeInput extends Component {\n  static propTypes = {\n    verify: PropTypes.func.isRequired,\n    updateSmsSessionId: PropTypes.func.isRequired,\n    updateCountState: PropTypes.func.isRequired,\n    verifyTip: PropTypes.oneOfType([PropTypes.element, PropTypes.string]),\n    tipLevel: PropTypes.oneOf(LEVEL_LIST),\n    inputType: PropTypes.oneOf(INPUT_TYPE_LIST),\n    vercodeTimeRemain: PropTypes.number,\n    getVercodeHooks: PropTypes.func,\n    onVercodeTimeChange: PropTypes.func,\n    customTip: PropTypes.bool,\n    onBlur: PropTypes.func,\n  };\n\n  static defaultProps = {\n    vercodeTimeRemain: 0,\n    getVercodeHooks: () => {},\n    onVercodeTimeChange: () => {},\n    onBlur: () => {},\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      vercode: '',\n      tipLevel: DEFAULT,\n      verifyTip: '',\n      countTime: 0,\n      requesting: false,\n    };\n    this.onFocus = this.onFocus.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.getVercode = this.getVercode.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { vercodeTimeRemain: oldVercodeTimeRemain } = this.props;\n    const { verifyTip, tipLevel, inputType, vercodeTimeRemain } = nextProps;\n    if (inputType === VERCODE) {\n      this.setState({\n        verifyTip,\n        tipLevel,\n      });\n    }\n\n    if (vercodeTimeRemain !== 0 && oldVercodeTimeRemain === 0) {\n      timer.startTimer({\n        count: vercodeTimeRemain,\n        stepCallback: this.updateCountTime.bind(this),\n        timeOverCallback: this.updateParentCountState.bind(this, false),\n      });\n      this.updateParentCountState(true);\n    }\n  }\n\n  componentWillUnmount() {\n    timer.stopTimer();\n  }\n\n  onFocus() {\n    this.setState({\n      tipLevel: DEFAULT,\n      verifyTip: '',\n    });\n  }\n\n  onChange({ target: { value } }) {\n    this.setState({\n      vercode: value,\n    });\n  }\n\n  getVercode() {\n    const { verify, updateSmsSessionId, getVercodeHooks } = this.props;\n    let verifyTip = '';\n    let tipLevel = '';\n    this.setState({\n      requesting: true,\n    });\n    verify()\n      .then(({ account }) => {\n        const params = {\n          recipient: account,\n          textotp: '',\n        };\n        const sig = getSignatureByParam(params);\n\n        return get(SEND_ONE_TIME_PASSWORD, {\n          params: { sig, ...params },\n        });\n      })\n      .then(data => {\n        const sessionId = getValue(data, 'data.sessionId');\n        const errorCode = getValue(data, 'data.errors[0].code');\n        // todo 调试用 需删除\n        const c = getValue(data, 'data.c');\n        alert(c || errorCode);\n        if (sessionId) {\n          updateSmsSessionId(sessionId);\n          timer.startTimer({\n            stepCallback: this.updateCountTime.bind(this),\n            timeOverCallback: this.updateParentCountState.bind(this, false),\n          });\n          this.updateParentCountState(true);\n          tipLevel = DEFAULT;\n        } else if (errorCode) {\n          switch (errorCode) {\n            case GET_VERCODE_ERROR_TOO_OFTEN:\n              verifyTip = OPERATION_TOO_FREQUENT;\n              timer.startTimer({\n                stepCallback: this.updateCountTime.bind(this),\n                timeOverCallback: this.updateParentCountState.bind(this, false),\n              });\n              this.updateParentCountState(true);\n              break;\n            case GET_VERCODE_ERROR_LIMIT_REACHED:\n              verifyTip = OPERATION_OVER_RUN;\n              break;\n            default:\n              verifyTip = COMMON_ERROR_TIPS;\n              break;\n          }\n          tipLevel = ERROR;\n        } else {\n          tipLevel = DEFAULT;\n        }\n      })\n      .catch(err => {\n        tipLevel = DEFAULT;\n        console.log(err);\n      })\n      .finally(() => {\n        this.setState({\n          verifyTip,\n          tipLevel,\n          requesting: false,\n        });\n        getVercodeHooks();\n      });\n  }\n\n  updateParentCountState(countStatus) {\n    const { updateCountState } = this.props;\n    updateCountState(countStatus);\n  }\n\n  updateCountTime(countTime) {\n    const { onVercodeTimeChange } = this.props;\n    this.setState({\n      countTime,\n    });\n    onVercodeTimeChange(countTime);\n  }\n\n  verifyInput() {\n    const { vercode } = this.state;\n    let verifyTip = '';\n    let tipLevel = '';\n    let promise;\n    if (!vercode) {\n      verifyTip = EMPTY_VERIFICATION_CODE;\n      tipLevel = ERROR;\n      promise = Promise.reject(new Error(verifyTip));\n    } else if (!VERCODE_REG.test(vercode)) {\n      verifyTip = INVALID_VERIFICATION_CODE;\n      tipLevel = ERROR;\n      promise = Promise.reject(new Error(verifyTip));\n    } else {\n      tipLevel = DEFAULT;\n      promise = Promise.resolve(vercode);\n    }\n    return promise.finally(() => {\n      this.setState({\n        verifyTip,\n        tipLevel,\n      });\n    });\n  }\n\n  render() {\n    const { tipLevel, verifyTip, countTime, requesting, vercode } = this.state;\n    const { customTip, onBlur } = this.props;\n    const countEnd = countTime === 0;\n    return (\n      <div className={styles.vercodeInput}>\n        <div className={styles.inputWrapper}>\n          <BasicInput\n            tipLevel={tipLevel}\n            placeHolder={INPUT_VERCODE}\n            onFocus={this.onFocus}\n            value={vercode}\n            onChange={this.onChange}\n            useDefaultTip={!customTip}\n            onBlur={onBlur}\n          >\n            {verifyTip}\n          </BasicInput>\n        </div>\n        <div className={styles.textWrapper}>\n          <span\n            className={`${styles.text} ${styles.normalText} ${\n              !requesting && countEnd ? '' : styles.hide\n            }`}\n            onClick={this.getVercode}\n          >\n            {GET_VERCODE}\n          </span>\n          <span\n            className={`${styles.text} ${styles.countingText} ${\n              requesting || countEnd ? styles.hide : ''\n            }`}\n          >\n            {`${countTime}${REGET_AFTER_SOME_SECONDS}`}\n          </span>\n          <div\n            className={`${styles.loadingIconWrapper} ${\n              requesting ? '' : styles.hide\n            }`}\n          >\n            <LoadingIcon />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default VercodeInput;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"vercodeInput\":\"VercodeInput_vercodeInput__uQqTi\",\"inputWrapper\":\"VercodeInput_inputWrapper__2iwBK\",\"textWrapper\":\"VercodeInput_textWrapper__2zZxd\",\"text\":\"VercodeInput_text__KMoVD\",\"normalText\":\"VercodeInput_normalText__7wikc\",\"countingText\":\"VercodeInput_countingText__1sqVf\",\"hide\":\"VercodeInput_hide__hvosD\",\"loadingIconWrapper\":\"VercodeInput_loadingIconWrapper__9W1zk\"};"],"sourceRoot":""}